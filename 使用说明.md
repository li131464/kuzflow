# 化工厂订单处理系统 - 使用说明

## 🎯 系统简介

本系统通过OCR文字识别和大模型信息提取技术，自动处理化工厂订单图片，提取关键信息：
- 甲方公司名称
- 购买物品名称  
- 购买物品数量（含单位）
- 下订单日期

## ⚡ 快速开始

### 第1步：环境设置
```bash
# 双击运行环境设置脚本
setup_environments.bat
```

### 第2步：运行完整流程
```bash
# 双击运行完整工作流程
run_complete_workflow.bat
```

## 📋 详细使用说明

### 环境要求
- Windows 10/11
- Miniconda/Anaconda
- NVIDIA GPU（推荐，CPU也可运行）
- 8GB+ RAM

### 文件结构
```
kuzflow/
├── setup_environments.bat          # 环境设置脚本
├── run_complete_workflow.bat       # 完整工作流程
├── test_ocr_compatible.py          # OCR测试脚本
├── test_deepseek_compatible.py     # DeepSeek测试脚本
├── show_final_results.py           # 结果显示脚本
├── OCR/
│   └── image/
│       └── 生成化工厂订单图片.png    # 测试图片
├── LLM/
│   └── DeepSeek-R1-Distill-Qwen-1.5B/  # AI模型
└── temp_results/                   # 处理结果目录
```

## 🔧 分步操作指南

### 方法1：一键运行（推荐）

1. **环境设置**（仅需运行一次）
   ```bash
   setup_environments.bat
   ```
   
2. **处理订单图片**
   ```bash
   run_complete_workflow.bat
   ```

### 方法2：分步运行

1. **OCR识别**
   ```bash
   conda activate ocr_env
   python test_ocr_compatible.py
   ```

2. **AI信息提取**
   ```bash
   conda activate deepseek_env  
   python test_deepseek_compatible.py
   ```

3. **查看结果**
   ```bash
   python show_final_results.py
   ```

## 📊 输出结果

### 处理成功后会生成：

1. **temp_results/ocr_result.json** - 详细OCR结果
2. **temp_results/ocr_text.txt** - 纯文本识别结果
3. **temp_results/final_result.json** - 最终提取结果  
4. **temp_results/visualization.jpg** - 可视化标注图片

### 结果示例：
```json
{
  "success": true,
  "ocr_info": {
    "text_lines_count": 12,
    "confidence_avg": 0.95,
    "raw_text": "XX化工贸易公司\n购买物品\n数量: 500斤\n..."
  },
  "ai_extraction": {
    "company_name": "XX化工贸易公司",
    "product_name": "化工原料",
    "product_quantity": "500斤", 
    "order_date": "2024年7月1日"
  }
}
```

## 🔄 处理新的订单图片

1. **替换图片**
   - 将新的订单图片保存为 `OCR/image/生成化工厂订单图片.png`
   - 或修改脚本中的图片路径

2. **重新处理**
   ```bash
   run_complete_workflow.bat
   ```

## ⚠️ 常见问题

### Q1: 环境设置失败
**解决方案：**
- 确保已安装Miniconda/Anaconda
- 检查网络连接
- 尝试使用管理员权限运行

### Q2: OCR识别精度低
**可能原因：**
- 图片质量不佳
- 文字模糊或倾斜
- 复杂背景干扰

**改进建议：**
- 使用高分辨率图片
- 确保文字清晰可见
- 图片较正、去噪处理

### Q3: AI提取信息不准确
**可能原因：**
- OCR识别错误
- 订单格式不标准
- 模型理解偏差

**改进方案：**
- 检查OCR识别结果
- 优化提示词模板
- 增加训练数据

### Q4: 显存不足
**解决方案：**
```bash
# 使用CPU运行DeepSeek
conda activate deepseek_env
set CUDA_VISIBLE_DEVICES=-1
python test_deepseek_compatible.py
```

## 🚀 性能优化

### 提升识别速度：
1. **使用GPU加速**
   - 确保安装CUDA
   - 使用GPU版本的依赖包

2. **批量处理**
   - 修改脚本支持多图片处理
   - 使用多进程并行处理

### 提升识别精度：
1. **图片预处理**
   - 去噪、锐化
   - 角度校正
   - 对比度增强

2. **模型优化**
   - 使用更大的模型
   - 针对特定场景微调

## 📞 技术支持

### 获取帮助：
1. 查看错误日志
2. 检查环境配置
3. 参考项目文档

### 常用命令：
```bash
# 查看conda环境
conda info --envs

# 激活环境
conda activate ocr_env
conda activate deepseek_env

# 查看依赖包
pip list

# 重新安装环境
conda remove -n ocr_env --all
conda remove -n deepseek_env --all
setup_environments.bat
```

## 📈 系统升级

### 升级OCR模型：
```bash
conda activate ocr_env
pip install --upgrade paddleocr
```

### 升级AI模型：
```bash
conda activate deepseek_env
pip install --upgrade transformers
```

---

## 🎉 完成！

按照以上步骤，您就可以成功使用化工厂订单处理系统了！

如遇问题，请检查：
1. ✅ 环境是否正确设置
2. ✅ 模型是否成功下载  
3. ✅ 图片路径是否正确
4. ✅ 系统权限是否足够

**祝您使用愉快！** 🚀 